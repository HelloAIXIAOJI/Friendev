# 提示词优化功能使用指南

## 🎯 功能概述

Friendev 内置了智能提示词优化功能，可以将您的简短或模糊输入自动扩展为详细、结构化的提示词，从而获得更好的 AI 回答。

---

## 🚀 快速开始

### 方式 1：使用 `!` 前缀（推荐）

在输入前加上 `!`，然后按 Enter：

```bash
>> !写个排序算法

⚙ 正在优化提示词...
✓ 优化完成

原始: 写个排序算法
优化: 请帮我实现一个排序算法，具体要求如下：
1. 算法类型：请使用快速排序（QuickSort）
2. 编程语言：Rust
3. 功能要求：
   - 支持泛型，可以对任意实现了 Ord trait 的类型进行排序
   - 使用原地排序，减少内存开销
4. 代码规范：
   - 添加完整的函数签名和类型注解
   - 包含必要的注释说明算法步骤
   - 提供使用示例

>> [优化后的内容已自动填充到输入框，可以继续编辑或直接发送]
```

### 方式 2：使用 Shift+Enter（部分终端支持）

输入内容后按 `Shift+Enter`（无需 `!` 前缀）：

```bash
>> 写个排序算法 [按 Shift+Enter]

⚙ 正在优化提示词...
✓ 优化完成
...
```

> **注意**：Shift+Enter 在某些终端（如 Windows PowerShell）可能不被识别，推荐使用 `!` 前缀。

---

## 💡 使用场景

### 场景 1：简短输入扩展

**输入：**
```bash
>> !写代码
```

**优化后：**
```
请帮我编写代码，具体需求如下：

1. 功能描述：[请描述具体功能]
2. 编程语言：[建议指定语言，如 Rust/Python/JavaScript]
3. 代码要求：
   - 代码结构清晰，易于理解
   - 包含必要的注释
   - 遵循最佳实践
4. 输入输出：[如果适用，说明输入输出格式]
5. 使用示例：提供简单的使用示例
```

---

### 场景 2：模糊需求明确化

**输入：**
```bash
>> !优化性能
```

**优化后：**
```
请帮我分析并优化项目的性能问题，具体内容：

1. 分析范围：
   - 识别当前代码中的性能瓶颈
   - 重点关注数据库查询、循环操作、内存分配
2. 优化建议：
   - 针对每个瓶颈提供具体的优化方案
   - 说明优化前后的性能差异（如果可以量化）
3. 代码示例：
   - 提供优化前后的代码对比
   - 标注关键优化点
4. 工具推荐：推荐适用的性能分析工具
```

---

### 场景 3：连续对话补充上下文

**历史对话：**
```bash
>> 帮我创建一个 Web API 服务
[AI 回复了基于 Actix-web 的实现...]
```

**当前输入：**
```bash
>> !加上认证
```

**优化后（自动引用上下文）：**
```
在刚才实现的 Web API 服务基础上，请添加认证功能，具体要求：

1. 认证方式：JWT（JSON Web Token）
2. 需要实现的功能：
   - 用户登录接口，验证用户名密码后返回 JWT token
   - Token 验证中间件，保护需要认证的路由
   - Token 刷新机制
3. 安全性要求：
   - 使用 bcrypt 存储密码哈希
   - Token 设置合理的过期时间（如1小时）
4. 集成方式：与现有的 Actix-web 架构集成
```

---

## 🎨 优化原则

AI 优化助手遵循以下原则：

1. ✅ **保持原意** - 不改变用户的核心需求
2. ✅ **增加细节** - 补充必要的背景信息和具体要求
3. ✅ **结构清晰** - 使用分点或分段，逻辑清晰
4. ✅ **结合上下文** - 如果有历史对话，适当引用相关内容
5. ✅ **长度适中** - 通常 2-5 倍原文长度，避免过度冗长

---

## 📋 最佳实践

### ✅ 适合优化的输入

1. **简短关键词**
   ```bash
   >> !写函数
   >> !修bug
   >> !重构
   ```

2. **模糊描述**
   ```bash
   >> !做个网站
   >> !提升速度
   >> !加功能
   ```

3. **连续对话的省略表达**
   ```bash
   >> !然后呢
   >> !继续
   >> !改一下
   ```

### ❌ 不需要优化的输入

1. **已经很详细的描述**
   ```bash
   >> 请使用 Rust 实现快速排序算法，要求支持泛型...
   # 无需优化，直接发送
   ```

2. **命令**
   ```bash
   >> /help
   >> /model list
   # 这些是系统命令，不是提示词
   ```

3. **简单问答**
   ```bash
   >> 你好
   >> 谢谢
   # 社交对话无需优化
   ```

---

## 🔧 技术细节

### 优化流程

1. **用户输入** - 输入 `!` 开头的文本
2. **检测触发** - 系统检测到优化请求
3. **上下文提取** - 获取最近 3 对对话（6 条消息）
4. **调用 AI** - 使用专门的优化 prompt 调用 AI
5. **结果展示** - 显示原始和优化后的对比
6. **自动填充** - 将优化结果填入输入框
7. **用户编辑** - 用户可继续修改或直接发送

### 上下文窗口

- **窗口大小**：最近 6 条消息（3 对对话）
- **内容截断**：每条消息最多 100 字符
- **作用**：帮助 AI 理解当前对话背景

---

## ⌨️ 快捷键总览

```
!            →  触发提示词优化（推荐）
Shift+Enter →  触发提示词优化（部分终端）
Enter        →  发送消息
Alt+Enter    →  换行（多行编辑）
Ctrl+Enter   →  换行（备选）
ESC          →  停止 AI 生成
Ctrl+C (x2)  →  退出程序
```

---

## 🌟 示例对话

### 示例 1：从零开始的项目

```bash
>> !做个TODO应用

⚙ 正在优化提示词...
✓ 优化完成

原始: 做个TODO应用
优化: 请帮我创建一个 TODO 待办事项应用，具体要求：

1. 技术栈：
   - 后端：Rust + Actix-web
   - 数据库：SQLite 或 PostgreSQL
   - 前端：可选（或提供 REST API）

2. 核心功能：
   - 添加待办事项（标题、描述、优先级、截止日期）
   - 查看待办列表（支持筛选和排序）
   - 标记完成/未完成
   - 编辑和删除待办事项

3. 数据模型：
   - Todo 结构体设计
   - 数据库表结构

4. API 接口：
   - POST /todos - 创建待办
   - GET /todos - 获取列表
   - PUT /todos/:id - 更新
   - DELETE /todos/:id - 删除

5. 代码组织：清晰的模块划分

>> [Enter 发送]

[AI 开始实现...]
```

### 示例 2：快速迭代

```bash
>> !写个HTTP客户端

[AI 实现了基础客户端...]

>> !加超时

⚙ 正在优化...
✓ 优化完成
[自动补充超时相关的详细需求]

>> [Enter 发送]

[AI 添加超时功能...]

>> !加重试

⚙ 正在优化...
✓ 优化完成
[补充重试策略、退避算法等]

>> [Enter 发送]

[AI 实现重试机制...]
```

---

## 🎓 学习建议

### 新手建议

1. **养成使用 `!` 的习惯**
   - 简短输入前加 `!`
   - 让 AI 帮你补充细节

2. **观察优化结果**
   - 学习如何写好提示词
   - 理解什么样的描述更有效

3. **适度编辑**
   - 优化结果不是完美的
   - 可以根据实际需求调整

### 进阶技巧

1. **关键词堆叠**
   ```bash
   >> !Rust HTTP客户端 超时重试
   # 在简短输入中包含关键信息
   ```

2. **连续优化**
   ```bash
   >> !基础功能
   [发送后...]
   >> !高级特性
   [发送后...]
   >> !错误处理
   ```

3. **结合上下文**
   - 优化功能会自动引用历史
   - 无需重复说明背景

---

## ❓ 常见问题

### Q1: 优化后的内容太长怎么办？
**A:** 您可以：
- 删除不需要的部分
- 保留核心需求
- 或者重新输入更具体的原始提示

### Q2: 优化结果不符合预期？
**A:** 尝试：
- 在原始输入中加入更多关键词
- 手动编辑优化结果
- 或者直接输入详细需求（不用优化）

### Q3: 能否关闭优化功能？
**A:** 
- 只要不用 `!` 前缀或 Shift+Enter，功能不会触发
- 正常输入不受影响

### Q4: 优化会消耗额外 API 调用吗？
**A:** 
- 是的，优化会调用一次 API
- 但使用简化的 prompt，token 消耗较少
- 换来的是更好的最终回答质量

---

## 🎉 总结

**提示词优化功能让您可以：**

- 💬 快速输入想法
- 🤖 AI 自动补充细节
- ✏️ 编辑调整需求
- 🚀 获得高质量回答

**记住一个简单的使用模式：**

```
简短想法 + ! → AI 优化 → 编辑（可选）→ 发送 → 完美回答
```

开始使用 `!` 前缀，让 AI 帮您写更好的提示词吧！✨
